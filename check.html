<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Aff-Safe — Device & IP Advanced Verifier</title>
<style>
  :root{
    --bg:#0b1220; --card:#081326; --muted:#9fb3da; --ok:#06d6a0; --warn:#ffb703; --bad:#ff6b6b; --text:#e6eef8;
  }
  body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:linear-gradient(180deg,#071026 0%, #061427 100%); color:var(--text); padding:20px;}
  .wrap{max-width:980px;margin:0 auto;}
  header{display:flex;align-items:center;gap:14px;margin-bottom:14px}
  h1{font-size:20px;margin:0}
  p.lead{margin:0;color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
  .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 30px rgba(2,6,23,.6);border:1px solid rgba(255,255,255,0.03)}
  .row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px dashed rgba(255,255,255,0.03)}
  .row:last-child{border-bottom:none}
  .k{color:var(--muted);font-size:13px}
  .v{font-weight:700}
  .pill{padding:6px 10px;border-radius:999px;font-weight:700}
  .ok{background:linear-gradient(90deg,#083e2a,#075e43);color:var(--ok)}
  .warn{background:linear-gradient(90deg,#3a2b00,#6b3e00);color:var(--warn)}
  .bad{background:linear-gradient(90deg,#3a0e12,#6b1014);color:var(--bad)}
  #final{margin-top:12px;padding:12px;border-radius:8px}
  .final-ok{background:linear-gradient(90deg,#022a20,#05342b);border-left:6px solid var(--ok)}
  .final-warn{background:linear-gradient(90deg,#2f2100,#472f00);border-left:6px solid var(--warn)}
  .final-bad{background:linear-gradient(90deg,#3a0e12,#5b1014);border-left:6px solid var(--bad)}
  pre{white-space:pre-wrap;color:#cfe6ff;background:rgba(255,255,255,0.02);padding:8px;border-radius:8px;margin:10px 0;font-size:13px}
  button{background:#0ea5a5;color:#021; border:none;padding:10px 12px;border-radius:8px;cursor:pointer;font-weight:700}
  .small{font-size:13px;color:var(--muted)}
  .note{font-size:13px;color:#cfe6ff;margin-top:8px}
  footer{color:var(--muted);font-size:13px;margin-top:16px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div>
      <h1>Aff-Safe — Device & IP Advanced Verifier</h1>
      <p class="lead">Run this page inside the browser/profile you plan to use (GoLogin/regular browser/phone). It runs multiple noninvasive checks and gives a risk score + action hints. Use ethically — do not use to bypass networks' policies.</p>
    </div>
    <div style="margin-left:auto">
      <button id="runBtn">Run checks</button>
    </div>
  </header>

  <div class="grid">
    <div class="card" id="left">
      <h3 style="margin:0 0 8px">Live checks</h3>
      <div id="checks"></div>

      <div id="final" style="display:none"></div>

      <div style="margin-top:10px">
        <button id="copyRaw">Copy JSON</button>
        <span style="margin-left:8px" class="small">• Use the JSON for logging or support requests</span>
      </div>

      <div style="margin-top:12px" class="note">Why this matters: ad networks combine IP reputation, browser/device fingerprint, WebRTC leaks, timezone/language and behavioral signals. This page summarizes those signals and shows where to fix issues.</div>
    </div>

    <div class="card">
      <h3 style="margin-top:0">Quick summary</h3>
      <div class="row"><div class="k">Public IP</div><div class="v" id="ipVal">—</div></div>
      <div class="row"><div class="k">Location (City,Region,ZIP)</div><div class="v" id="locVal">—</div></div>
      <div class="row"><div class="k">ISP / ASN</div><div class="v" id="ispVal">—</div></div>
      <div class="row"><div class="k">IP Type</div><div class="v" id="ipType">—</div></div>
      <div class="row"><div class="k">Browser / UA</div><div class="v" id="uaVal">—</div></div>
      <div class="row"><div class="k">WebRTC Leak</div><div class="v" id="webrtcVal">—</div></div>
      <div class="row"><div class="k">Canvas / WebGL</div><div class="v" id="canvasVal">—</div></div>
      <div class="row"><div class="k">Timezone</div><div class="v" id="tzVal">—</div></div>
      <div class="row"><div class="k">Language</div><div class="v" id="langVal">—</div></div>
      <div style="margin-top:8px" id="scoreCard"></div>
    </div>
  </div>

  <div style="margin-top:14px" class="card">
    <h3 style="margin:0 0 8px">Raw details / developer info</h3>
    <pre id="raw">(run checks to populate)</pre>
  </div>

  <footer>Use responsibly. This tool helps you check technical signals — it does not give permission to violate any platform's rules. If you get UNSAFE, stop and fix the flagged items.</footer>
</div>

<script>
/* ---------------------------
   Utility helpers
   --------------------------- */
const el = id => document.getElementById(id);
function addRow(name, value, status, note){
  const c = el('checks');
  const div = document.createElement('div');
  div.className='row';
  div.innerHTML = `<div class="k">${name}</div><div style="text-align:right">
    <div class="v">${value}</div>
    <div style="margin-top:6px"><span class="pill ${status==='ok'?'ok':status==='warn'?'warn':'bad'}">${status.toUpperCase()}</span></div>
  </div>`;
  c.appendChild(div);
  if(note){
    const n = document.createElement('div'); n.style.color='#9fb3da'; n.style.fontSize='13px'; n.style.margin='6px 0 10px'; n.textContent = 'Note: '+note;
    c.appendChild(n);
  }
}
async function sha256hex(str){
  const buf = new TextEncoder().encode(str);
  const hash = await crypto.subtle.digest('SHA-256', buf);
  return Array.from(new Uint8Array(hash)).map(b=>b.toString(16).padStart(2,'0')).join('');
}

/* ---------------------------
   Low-level checks
   --------------------------- */
async function getPublicIP(){
  try{
    const r = await fetch('https://api.ipify.org?format=json'); const j=await r.json(); return j.ip;
  }catch(e){ return null; }
}
async function getIPInfo(){
  try{
    // ipapi.co tends to be reliable; fallback to ipinfo.io if needed
    const r = await fetch('https://ipapi.co/json/'); if(!r.ok) throw 0; return await r.json();
  }catch(e){
    try{ const r2=await fetch('https://ipinfo.io/json?token='); if(r2.ok) return await r2.json(); }catch(e2){}
    return null;
  }
}
function parseUA(){
  return navigator.userAgent || 'unknown';
}
function detectWebDriver(){
  if(navigator.webdriver) return true;
  const black = ['Headless','Phantom','puppeteer','Playwright','selenium','slimerjs']; const ua = navigator.userAgent || '';
  for(const t of black) if(ua.includes(t)) return true;
  return false;
}
function getWebGL(){
  try{
    const canvas=document.createElement('canvas');
    const gl=canvas.getContext('webgl')||canvas.getContext('experimental-webgl');
    if(!gl) return null;
    const dbg = gl.getExtension('WEBGL_debug_renderer_info');
    const vendor = dbg ? gl.getParameter(dbg.UNMASKED_VENDOR_WEBGL) : 'unknown';
    const renderer = dbg ? gl.getParameter(dbg.UNMASKED_RENDERER_WEBGL) : 'unknown';
    return {vendor, renderer};
  }catch(e){return null;}
}
async function getCanvasHash(){
  try{
    const canvas=document.createElement('canvas'); canvas.width=900; canvas.height=200;
    const ctx=canvas.getContext('2d');
    ctx.fillStyle='#f3f7fb'; ctx.fillRect(0,0,900,200);
    ctx.textBaseline='top'; ctx.font='16px Arial'; ctx.fillStyle='#111'; ctx.fillText('AffSafeTest-'+navigator.userAgent,10,10);
    ctx.fillStyle='rgba(200,90,150,0.6)'; ctx.fillRect(220,50,200,40);
    const data = canvas.toDataURL();
    return await sha256hex(data);
  }catch(e){ return null;}
}
async function getSTUNCandidates(timeout=1600){
  return new Promise((resolve)=>{
    const ips = new Set();
    const pc = new RTCPeerConnection({iceServers:[{urls:'stun:stun.l.google.com:19302'}]});
    pc.createDataChannel(''); pc.onicecandidate = e => {
      if(!e.candidate) return;
      const s = e.candidate.candidate;
      const parts = s.split(' ');
      for(let p of parts){
        if(p.match(/\d+\.\d+\.\d+\.\d+/)) ips.add(p);
      }
    };
    pc.createOffer().then(o=>pc.setLocalDescription(o)).catch(()=>{});
    setTimeout(()=>{ try{pc.close();}catch(e){}; resolve(Array.from(ips)); }, timeout);
  });
}

/* ---------------------------
   Heuristics & scoring
   --------------------------- */
function parseBrowser(ua){
  // simplified UA parse for common engines
  const lower = ua;
  const res = {name:'Unknown',version:null,platform:'Unknown'};
  if(/Android/i.test(ua)) res.platform='Android';
  else if(/iPhone|iPad|iPod|iOS/i.test(ua)) res.platform='iOS';
  else if(/Win/i.test(ua)) res.platform='Windows';
  else if(/Macintosh|Mac OS X/i.test(ua)) res.platform='Mac';
  else if(/Linux/i.test(ua)) res.platform='Linux';
  const m = ua.match(/(Chrome|Firefox|Safari|Edge)\/([0-9.]+)/i);
  if(m){ res.name = m[1]; res.version = m[2]; }
  return res;
}
function versionMajor(v){
  if(!v) return null; const m = v.split('.')[0]; return parseInt(m)||null;
}

function computeRiskScore(flags){
  // flags: object with boolean markers or severity
  // We'll produce score 0..100 (higher = worse)
  let score = 0;
  // IP issues
  if(flags.ip_unreachable) score += 30;
  if(flags.ip_datacenter) score += 40;
  if(flags.ip_vpn_like) score += 30;
  if(flags.webrtc_leak) score += 40;
  // UA / webdriver
  if(flags.webdriver) score += 50;
  if(flags.ua_mismatch) score += 25;
  // Canvas/WebGL missing / generic
  if(flags.canvas_missing) score += 20;
  if(flags.webgl_unknown) score += 15;
  // timezone/lang mismatch
  if(flags.tz_mismatch) score += 20;
  if(flags.lang_mismatch) score += 10;
  // clamp
  if(score>100) score=100;
  return score;
}

/* ---------------------------
   Main run
   --------------------------- */
async function runAll(){
  el('checks').innerHTML = ''; el('raw').textContent='(running...)';
  el('final').style.display='none';
  // Gather
  const ua = parseUA();
  const parsed = parseBrowser(ua);
  const canvasHash = await getCanvasHash();
  const webgl = getWebGL();
  const stun = await getSTUNCandidates();
  const publicIP = await getPublicIP();
  const ipinfo = await getIPInfo();

  // Basic checks & heuristics
  const flags = {
    webdriver: detectWebDriver(),
    webrtc_leak: false,
    ip_unreachable: !publicIP,
    ip_datacenter: false,
    ip_vpn_like: false,
    ua_mismatch: false,
    canvas_missing: !canvasHash,
    webgl_unknown: !(webgl && webgl.vendor && webgl.renderer && webgl.renderer!=='unknown'),
    tz_mismatch: false,
    lang_mismatch: false
  };

  // WebRTC candidates check: if STUN returns your real public IP -> possible leak / no proxy isolation
  if(stun && stun.length>0 && publicIP){
    if(stun.includes(publicIP)) flags.webrtc_leak = true;
  }

  // IP info heuristics
  let ipType = 'Unknown';
  if(ipinfo && ipinfo.org){
    const org = (ipinfo.org||'').toLowerCase();
    el('ispVal').textContent = ipinfo.org;
    if(/amazon|digitalocean|linode|ovh|hetzner|cloud|google|microsoft|azure|aws|contabo|vultr|m247|choopa/.test(org)){
      flags.ip_datacenter = true; ipType='Datacenter/Hosting';
    } else if(/mobile|verizon|att|tmobile|spectrum|comcast|cox|charter|telefonica|vodafone|centurylink/.test(org)){
      ipType='Residential / Mobile ISP';
    } else {
      ipType='ISP ('+ipinfo.org+')';
    }
  } else if(publicIP){
    ipType='Public IP';
  }

  // timezone vs ip country
  const tz = Intl.DateTimeFormat().resolvedOptions().timeZone || 'unknown';
  if(ipinfo && ipinfo.country_name){
    const tlower = tz.toLowerCase();
    const countryLower = (ipinfo.country_name||'').toLowerCase();
    // crude check: timezone text containing country name is uncommon, instead we check major tokens
    // we'll consider mismatch if timezone country code not sensible (best-effort)
    if(countryLower && !tlower.includes(countryLower.split(' ')[0])) {
      // not necessarily a fail (many timezones don't include country); mark warn
      flags.tz_mismatch = true;
    }
    // language vs country
    const lang = (navigator.language||'').toLowerCase();
    if(countryLower.includes('united states') && !lang.includes('en')) flags.lang_mismatch = true;
  }

  // UA vs platform mismatch
  const platformGuess = parsed.platform;
  if(platformGuess==='Android' && !/Android/i.test(ua)) flags.ua_mismatch = true;
  if(platformGuess==='iOS' && !/iPhone|iPad|iPod|iOS/i.test(ua)) flags.ua_mismatch = true;
  // browser version plausibility: warn if version below 70 or not found
  const major = versionMajor(parsed.version);
  let browserAgeWarn = false;
  if(major && major < 70) browserAgeWarn = true;

  // Compose checks (visual)
  addRow('Public IP', publicIP||'Unavailable', publicIP? 'ok':'fail', publicIP? '':'Cannot reach ip service');
  addRow('IP Location', ipinfo? `${ipinfo.city||'—'}, ${ipinfo.region||'—'} ${ipinfo.postal||''}` : 'Unavailable', ipinfo? 'ok':'warn', ipinfo? '':'Location lookup failed');
  addRow('ISP / ASN', ipinfo? (ipinfo.org||'—') : '—', (flags.ip_datacenter? 'fail':'ok'), flags.ip_datacenter ? 'Datacenter/Hosting provider detected — high risk' : '');
  addRow('IP Type heuristic', ipType, (flags.ip_datacenter? 'fail':'ok'), '');
  addRow('WebRTC STUN candidates', (stun && stun.length)? stun.join(', ') : 'none', flags.webrtc_leak? 'fail' : (stun && stun.length? 'ok':'warn'), flags.webrtc_leak ? 'Public IP appears in STUN candidates — proxy leak' : '');

  addRow('User-Agent', ua, 'ok', `Parsed browser: ${parsed.name} ${parsed.version||'n/a'} on ${parsed.platform}`);
  addRow('Browser version plausibility', parsed.version||'unknown', browserAgeWarn? 'warn':'ok', browserAgeWarn? 'Browser major version looks old (warn)':'Version seems plausible');
  addRow('WebDriver / Headless', flags.webdriver? 'detected' : 'not detected', flags.webdriver? 'fail':'ok', flags.webdriver? 'navigator.webdriver or headless UA found — automation likely':'');

  addRow('Canvas fingerprint (sha256)', canvasHash? canvasHash.slice(0,16)+'...' : 'blocked', canvasHash? 'ok':'warn', canvasHash? 'Canvas available — unique fingerprint' : 'Canvas blocked or unavailable (heavy blocking)');

  if(webgl){
    addRow('WebGL vendor/renderer', `${webgl.vendor} | ${webgl.renderer}`, flags.webgl_unknown? 'warn':'ok', flags.webgl_unknown? 'WebGL unavailable or generic':'Hardware WebGL info present');
  } else addRow('WebGL', 'unavailable', 'warn', 'WebGL missing — may be blocked or headless');

  addRow('Screen resolution', `${screen.width}×${screen.height}`, 'ok', '');
  addRow('Touch support', (('ontouchstart' in window) || navigator.maxTouchPoints>0) ? 'yes' : 'no', 'ok', '');

  addRow('Timezone (browser)', tz, flags.tz_mismatch? 'warn':'ok', flags.tz_mismatch? 'Timezone does not appear to match IP region — review':'');

  addRow('Language', navigator.language || 'unknown', flags.lang_mismatch? 'warn':'ok', flags.lang_mismatch? 'Language mismatch with IP country (possible anomaly)':'Language matches expectation');

  // compute risk score
  const risk = computeRiskScore(flags);
  const riskText = risk < 25 ? 'LOW' : (risk < 60 ? 'MEDIUM' : 'HIGH');

  // final box
  const finalBox = el('final');
  finalBox.style.display='block';
  finalBox.className = 'card ' + (risk < 25 ? 'final-ok' : (risk < 60 ? 'final-warn' : 'final-bad'));
  finalBox.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <div style="font-size:16px;font-weight:800">Overall verdict: <span style="font-weight:900">${riskText}</span></div>
      <div class="small" style="color:#cfe6ff;margin-top:6px">Risk score: ${risk}/100 — ${risk < 25 ? 'Safe to proceed (technical signals low risk).' : (risk < 60 ? 'Caution: address warnings before sensitive use.' : 'Unsafe: fix critical issues first.')}</div>
    </div>
    <div style="text-align:right">
      <div style="font-size:14px;font-weight:800">Action</div>
      <div class="small" style="margin-top:6px">${risk < 25 ? 'OK — you may use this profile, still respect network rules.' : risk < 60 ? 'Fix warnings: (timezone, UA, canvas, webgl, IP) then re-check.' : 'Do not use. Resolve IP/provider and headless/WEbrtc leaks.'}</div>
    </div>
  </div>`;

  // populate quick summary pane
  el('ipVal').textContent = publicIP || '—';
  el('locVal').textContent = ipinfo ? `${ipinfo.city||'—'}, ${ipinfo.region||'—'} ${ipinfo.postal||''}` : '—';
  el('ispVal').textContent = ipinfo ? ipinfo.org || '—' : '—';
  el('ipType').textContent = flags.ip_datacenter ? 'Datacenter/Hosting (High risk)' : 'ISP / Residential (OK)';
  el('uaVal').textContent = parsed.name + ' ' + (parsed.version||'n/a') + ' — ' + parsed.platform;
  el('webrtcVal').textContent = flags.webrtc_leak ? 'LEAKED' : (stun && stun.length ? 'No leak' : 'Unknown');
  el('canvasVal').textContent = canvasHash ? (canvasHash.slice(0,12)+'...') : 'blocked';
  el('tzVal').textContent = tz;
  el('langVal').textContent = navigator.language || '—';

  // raw
  const raw = {publicIP,ipinfo,parsed,flags,canvasHash,webgl,stun,timezone:tz,risk};
  el('raw').textContent = JSON.stringify(raw,null,2);

  // score card
  el('scoreCard').innerHTML = `<div style="padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)"><strong>Risk:</strong> ${risk}/100 — <strong>${riskText}</strong></div>`;

  // copy handler
  el('copyRaw').onclick = ()=>{ navigator.clipboard.writeText(JSON.stringify(raw,null,2)).then(()=>alert('Copied report to clipboard')); };
}

/* ---------------------------
   Wire run button
   --------------------------- */
el('runBtn').addEventListener('click', async ()=>{
  el('checks').innerHTML = '';
  el('raw').textContent = '(running...)';
  await runAll();
});

// auto-run once
setTimeout(()=>document.getElementById('runBtn').click(),200);
</script>
</body>
</html>
